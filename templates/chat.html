<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KumuComputer App</title>

    <!-- CSS for chat and common CSS file. -->
    <link rel="stylesheet" href="../static/common.css">
    <link rel="stylesheet" href="../static/chat.css">

    <!-- "Marked" for markdown rendering in chat. OpenAI often uses markdown in responses. -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- DOMPurify to santize user inputs. -->
    <script type="text/javascript" src="/static/purify.min.js"></script>
</head>
<body>

    <!-- Sidebar with settings and buttons -->
    <div class="sidebar">
        <h2>Kumu<a class="gradientText">Computer</a></h2>
        <button onclick="clearChat()">New Chat</button>
        <button onclick="addFile()">Add File</button>
        <div class="llm-settings">
            <button onclick="toggleSettings()">LLM Settings</button>
            <div id="settingsPanel" style="display: none;">
                <label>
                    Model:
                    <select id="llmModel">
                        <option disabled>== Normal Models ==</option>
                        <option value="gpt-4.1">gpt-4.1</option>
                        <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                        <option value="gpt-4.1">gpt-4.1-nano</option>
                        <option disabled>== Reasoning Models ==</option> 
                        <option value="o3">o3</option>
                        <option value="o3-pro">o3-pro</option>
                        <option value="o4-mini">o4-mini</option> 
                    </select>
                </label>
                <label>
                    Temperature:
                    <span id="tempValue"><b>0.7</b></span>
                    <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" />
                </label>

                <label><br>
                    Max Tokens:
                    <input type="number" id="maxTokens" min="10" max="32768" value="4096" />
                </label>
            </div>
        </div>
        To do:
        <ol class="todo">
            <li>Fix settings</li>
            <li>Add option to export to PDF for easy review</li>
            <li>Proper file browsing system</li>
            <li>"Hotswappable vector stores" for easy file management</li>
            <li>Add option to add multiple files at once</li>
        </ol>
    </div>

    <!-- Main chat interface. Check JS file for more details on workings. -->
    <div class="chat-container">
        <div class="chat-box" id="chatBox">
            <!-- Starter bot message --->
             <div class="chat-message bot">Hi! How can I help you today?</div>
        </div>
        <div class="chat-input">
            <textarea id="userInput" rows="2" placeholder="Send a message..."></textarea>
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
    
    <!-- Popup settings menu -->
    <div class="popup" id="settingsPopup">
        <h1>Sources</h1><br>
        <p>Vector store referenced: <b>vs_6875a8264e04819181f92591e60c1054</b></p><br>
        <h3>Files referenced:</h3>
        <ul>
            <li>khha_19270621.pdf (4.1mB) :: Similarity: 0.94</li>
            <li>khh_18610501.pdf (4.0mB) :: Similarity: 0.73</li>
        </ul><br>
        <h3>Parameters:</h3>
        <ul>
            <li>Model: gpt-4.1-mini</li>
            <li>Temperature: 0.7</li>
            <li>Max Tokens: 4096</li>
        </ul><br>
        <input type="checkbox" checked> Include citations in footer? <br>
        <button class="button">Get PDF summary</button>
        <button class="button">Delete current chat</button>

        <button class="roundbutton" onclick="toggleSettings()"><b>X</b> Return to chat</button>
    </div>
    <!-- MAIN SCRIPT -->
    <script src="../static/chat.js"></script>
</body>
</html>
